<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/myfavicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/myfavicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="PNikZLgEROlB0REDk-jntc-fTWVFIkSNJZbICyge9H4">
  <meta name="msvalidate.01" content="5D5B4EDEB3F20663D4B0CBA6229645B0">
  <meta name="baidu-site-verification" content="N9MkUFl4G3">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="fonts.loli.net/css?family=EB Garamond:300,300italic,400,400italic,700,700italic|Cinzel Decorative:300,300italic,400,400italic,700,700italic|Noto Serif SC:300,300italic,400,400italic,700,700italic|Source Code Pro:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('https://blog.shipengx.com').hostname,
    root: '/',
    scheme: 'Mist',
    version: '7.7.1',
    exturl: true,
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":true},
    copycode: {"enable":true,"show_result":true,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: true,
    mediumzoom: false,
    lazyload: true,
    pangu: false,
    comments: {"style":"tabs","active":null,"storage":true,"lazyload":true,"nav":null},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta name="description" content="无迹卡尔曼滤波基于无迹变换，无迹变换研究的是如何通过确定的采样点捕获经非线性变换的高斯随机变量的后验分布的问题。通过无迹变换得到相应的统计特性后，再结合标准卡尔曼滤波框架，便得到无迹卡尔曼滤波。标准无迹卡尔曼滤波的计算量与扩展卡尔曼滤波相当，但滤波精度要优于扩展卡尔曼滤波。">
<meta property="og:type" content="article">
<meta property="og:title" content="从贝叶斯滤波到无迹卡尔曼滤波">
<meta property="og:url" content="https://blog.shipengx.com/archives/cfd8b171.html">
<meta property="og:site_name" content="朝花夕拾">
<meta property="og:description" content="无迹卡尔曼滤波基于无迹变换，无迹变换研究的是如何通过确定的采样点捕获经非线性变换的高斯随机变量的后验分布的问题。通过无迹变换得到相应的统计特性后，再结合标准卡尔曼滤波框架，便得到无迹卡尔曼滤波。标准无迹卡尔曼滤波的计算量与扩展卡尔曼滤波相当，但滤波精度要优于扩展卡尔曼滤波。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://image.shipengx.com/%E7%9B%AE%E5%BD%95-%E4%BB%8E%E8%B4%9D%E5%8F%B6%E6%96%AF%E6%BB%A4%E6%B3%A2%E5%88%B0%E6%97%A0%E8%BF%B9%E5%8D%A1%E5%B0%94%E6%9B%BC%E6%BB%A4%E6%B3%A2.png">
<meta property="og:image" content="https://image.shipengx.com/%E6%97%A0%E8%BF%B9%E5%8F%98%E6%8D%A2%E7%A4%BA%E4%BE%8B.png">
<meta property="og:image" content="https://image.shipengx.com/alpha%20%E5%8F%96%E4%B8%8D%E5%90%8C%E5%80%BC%E6%97%B6%20sigma%20%E7%82%B9%E7%9A%84%E6%95%A3%E5%B8%83%E7%A4%BA%E4%BE%8B.png">
<meta property="og:image" content="https://image.shipengx.com/%E5%8F%AF%E5%8A%A0%E6%80%A7%E5%99%AA%E5%A3%B0%E6%9D%A1%E4%BB%B6%E4%B8%8B%E7%9A%84%E6%97%A0%E8%BF%B9%E5%8D%A1%E5%B0%94%E6%9B%BC%E6%BB%A4%E6%B3%A2%E7%AE%97%E6%B3%95%E6%B5%81%E7%A8%8B%E5%9B%BE.png">
<meta property="og:image" content="https://image.shipengx.com/%E9%9D%9E%E5%8F%AF%E5%8A%A0%E6%80%A7%E5%99%AA%E5%A3%B0%E6%9D%A1%E4%BB%B6%E4%B8%8B%E7%9A%84%E6%97%A0%E8%BF%B9%E5%8D%A1%E5%B0%94%E6%9B%BC%E6%BB%A4%E6%B3%A2%E7%AE%97%E6%B3%95%E6%B5%81%E7%A8%8B%E5%9B%BE.png">
<meta property="og:image" content="https://image.shipengx.com/CTRV%20%E8%BF%90%E5%8A%A8%E6%A8%A1%E5%9E%8B%E7%A4%BA%E6%84%8F%E5%9B%BE.png">
<meta property="article:published_time" content="2020-10-03T04:43:54.000Z">
<meta property="article:modified_time" content="2022-05-12T06:03:08.534Z">
<meta property="article:author" content="ShiPeng">
<meta property="article:tag" content="自动驾驶">
<meta property="article:tag" content="数学">
<meta property="article:tag" content="滤波">
<meta property="article:tag" content="无迹卡尔曼滤波">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://image.shipengx.com/%E7%9B%AE%E5%BD%95-%E4%BB%8E%E8%B4%9D%E5%8F%B6%E6%96%AF%E6%BB%A4%E6%B3%A2%E5%88%B0%E6%97%A0%E8%BF%B9%E5%8D%A1%E5%B0%94%E6%9B%BC%E6%BB%A4%E6%B3%A2.png">

<link rel="canonical" href="https://blog.shipengx.com/archives/cfd8b171.html">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>
<link href="https://fonts.loli.net/css2?family=Noto+Serif+SC:wght@400;500;700&display=swap" rel="stylesheet">
<link href="https://fonts.loli.net/css2?family=ZCOOL+XiaoWei&display=swap" rel="stylesheet">
<link href="https://fonts.loli.net/css2?family=Ma+Shan+Zheng&display=swap" rel="stylesheet">
<link href="https://fonts.loli.net/css2?family=Zhi+Mang+Xing&display=swap" rel="stylesheet">

  <title>从贝叶斯滤波到无迹卡尔曼滤波 | 朝花夕拾</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">朝花夕拾</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <h1 class="site-subtitle" itemprop="description">输出倒逼思考</h1>
      
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类<span class="badge">26</span></a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签<span class="badge">40</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档<span class="badge">86</span></a>

  </li>
        <li class="menu-item menu-item-books">

    <a href="/books/" rel="section"><i class="fa fa-fw fa-book"></i>读书</a>

  </li>
        <li class="menu-item menu-item-zhihu">

    <span class="exturl" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS9zaGktcGVuZy04"><i class="fa fa-fw fa-columns"></i>知乎</span>

  </li>
        <li class="menu-item menu-item-gitbook">

    <span class="exturl" data-url="aHR0cHM6Ly9ib29rLnNoaXBlbmd4LmNvbQ=="><i class="fa fa-fw fa-pencil"></i>GitBook</span>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="搜索..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL3JvY3NoaQ==" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></span>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.shipengx.com/archives/cfd8b171.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="ShiPeng">
      <meta itemprop="description" content="Stay hungry, stay foolish.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="朝花夕拾">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          从贝叶斯滤波到无迹卡尔曼滤波
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-10-03 12:43:54" itemprop="dateCreated datePublished" datetime="2020-10-03T12:43:54+08:00">2020-10-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-05-12 14:03:08" itemprop="dateModified" datetime="2022-05-12T14:03:08+08:00">2022-05-12</time>
              </span>

          <br>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%87%AA%E5%8A%A8%E9%A9%BE%E9%A9%B6/" itemprop="url" rel="index">
                    <span itemprop="name">自动驾驶</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%87%AA%E5%8A%A8%E9%A9%BE%E9%A9%B6/%E5%A4%9A%E4%BC%A0%E6%84%9F%E5%99%A8%E4%BF%A1%E6%81%AF%E8%9E%8D%E5%90%88/" itemprop="url" rel="index">
                    <span itemprop="name">多传感器信息融合</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/archives/cfd8b171.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/archives/cfd8b171.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  
            <div class="post-description">无迹卡尔曼滤波基于无迹变换，无迹变换研究的是如何通过确定的采样点捕获经非线性变换的高斯随机变量的后验分布的问题。通过无迹变换得到相应的统计特性后，再结合标准卡尔曼滤波框架，便得到无迹卡尔曼滤波。标准无迹卡尔曼滤波的计算量与扩展卡尔曼滤波相当，但滤波精度要优于扩展卡尔曼滤波。</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="目录" class="heading-control"><a href="#目录" class="headerlink" title="目录"></a>目录<a class="heading-anchor" href="#目录" aria-hidden="true"></a></h1><p><img data-src="https://image.shipengx.com/%E7%9B%AE%E5%BD%95-%E4%BB%8E%E8%B4%9D%E5%8F%B6%E6%96%AF%E6%BB%A4%E6%B3%A2%E5%88%B0%E6%97%A0%E8%BF%B9%E5%8D%A1%E5%B0%94%E6%9B%BC%E6%BB%A4%E6%B3%A2.png" alt="目录-从贝叶斯滤波到无迹卡尔曼滤波"></p>
<h1 id="0-引言" class="heading-control"><a href="#0-引言" class="headerlink" title="0 引言"></a>0 引言<a class="heading-anchor" href="#0-引言" aria-hidden="true"></a></h1><p>在此前的文章<a href="https://blog.shipengx.com/archives/ea375326.html">《从贝叶斯滤波到扩展卡尔曼滤波》</a>中，我们讲述了扩展卡尔曼滤波通过一阶泰勒级数展开将非线性高斯系统的状态转移函数 $f(x)$ 和（或）观测函数 $h(x)$ 线性化，然后采用标准卡尔曼滤波框架实现状态量的滤波过程。扩展卡尔曼滤波存在两方面的明显缺点：</p>
<ul>
<li>一阶泰勒级数展开忽略了二阶及以上的高阶项，因此精度一般（通常称为一阶精度），对于高度非线性问题效果较差；</li>
<li>雅可比矩阵的计算较为繁琐，容易出错。</li>
</ul>
<p>为解决强非线性条件下的状态估计问题，1995 年，S. J. Julier 和 J. K. Uhlmann 等人提出了无迹卡尔曼滤波（Unscented Kalman Filter，UKF）算法，并由 E. A. Wan 和 R. Vander Merwe 等人进一步完善。</p>
<p>无迹卡尔曼滤波基于无迹变换（Unscented Transform，UT），无迹变换研究的是如何通过<strong>确定的</strong>采样点捕获经非线性变换的高斯随机变量的后验分布的问题。通过无迹变换得到相应的统计特性后，再结合标准卡尔曼滤波框架，便得到无迹卡尔曼滤波。标准无迹卡尔曼滤波的计算量与扩展卡尔曼滤波相当，但滤波精度要优于扩展卡尔曼滤波。</p>
<h1 id="1-无迹变换" class="heading-control"><a href="#1-无迹变换" class="headerlink" title="1 无迹变换"></a>1 无迹变换<a class="heading-anchor" href="#1-无迹变换" aria-hidden="true"></a></h1><h2 id="1-1-什么是无迹变换" class="heading-control"><a href="#1-1-什么是无迹变换" class="headerlink" title="1.1 什么是无迹变换"></a>1.1 什么是无迹变换<a class="heading-anchor" href="#1-1-什么是无迹变换" aria-hidden="true"></a></h2><p>无迹变换的核心理念：</p>
<blockquote>
<p>近似概率分布比近似任意的非线性函数或变换要相对容易。</p>
</blockquote>
<p>无迹变换要解决的问题是：已知某随机变量（多维情形下是随机向量）的概率分布（均值和方差），求其经过某非线性函数 $g(·)$ 变换后的概率分布。基于上述思想，无迹变换的主要步骤为：</p>
<p>(1) 根据<strong>某种规则</strong>对随机变量的概率分布进行<strong>确定性采样</strong>，并为采样点<strong>分配权重</strong>（均值权重和方差权重），采样点我们通常称之为 sigma 点；</p>
<p>(2) 将每一个 sigma 点进行<strong>非线性变换</strong>，得到新的 sigma 点；</p>
<p>(3) 对非线性变换后的新的 sigma 点进行<strong>加权求和</strong>，分别计算加权均值和加权方差，用加权均值和加权方差<strong>近似表征</strong>随机变量经非线性变换后的概率分布。</p>
<p>如下图所示（《概率机器人》第 3.4 节 P49）：</p>
<p><img data-src="https://image.shipengx.com/%E6%97%A0%E8%BF%B9%E5%8F%98%E6%8D%A2%E7%A4%BA%E4%BE%8B.png" alt="无迹变换示例"></p>
<p>无迹卡尔曼滤波中使用的确定性采样方法是 sigma 点采样方法的一种具体实现，中心差分卡尔曼滤波（Central Difference Kalman Filter，CDKF）使用了 sigma 点采样方法的另一种具体实现，这类滤波算法我们统称为 sigma 点卡尔曼滤波（Sigma-Point Kalman Filter，SPKF）算法。</p>
<p>按照历史发展脉络来讲，无迹变换主要包括两种形式：一般形式的无迹变换和比例无迹变换（Scaled Unscented Transform，SUT）。两种无迹变换的区别主要体现在采样规则和权重计算上，下面将分别进行阐述。</p>
<h2 id="1-2-一般形式的无迹变换" class="heading-control"><a href="#1-2-一般形式的无迹变换" class="headerlink" title="1.2 一般形式的无迹变换"></a>1.2 一般形式的无迹变换<a class="heading-anchor" href="#1-2-一般形式的无迹变换" aria-hidden="true"></a></h2><p>假设存在 $n$ 维随机向量 $X$，其服从均值 $\mu_x$ 和协方差 $\Sigma_x$ 的正态分布：</p>
<script type="math/tex; mode=display">
X \sim \mathcal{N}(\mu_x, \Sigma_x)</script><p>将 $X$ 经过非线性函数 $g(·)$ 进行变换，得到随机向量 $Y$，我们使用一般形式的无迹变换估计 $Y$ 的概率分布。一般形式的无迹变换最早由 Julier 等人提出，其主要操作流程如下所述：</p>
<p><strong>步骤一：参数选择与权重计算</strong></p>
<p>一般形式的无迹变换只涉及一个外部引入参数 $\kappa$，各 sigma 点（$2n+1$ 个）的权重分配如下：</p>
<script type="math/tex; mode=display">
W^{(i)} =
\begin{cases}
    \frac{\kappa}{n+\kappa} & i = 0 \\
    \frac{1}{2(n+\kappa)} & i = 1, ··· , 2n
\end{cases}</script><p>其中，$\kappa \in \mathbb{R}$，表征了 sigma 点相对均值的散布程度，$\kappa$ 越大，非均值处的 sigma 点距离均值越远（参考步骤二），且所占权重越小，而均值处 sigma 点所占权重则相对越大。对于高斯问题，$n+\kappa = 3$ 是一个比较好的选择，对于非高斯问题（是的，无迹变换也适用于非高斯问题），$\kappa$ 应该选择其它更恰当的值。</p>
<p><strong>步骤二：确定性采样</strong></p>
<p>通常情况下，siama 点位于均值处及对称分布于主轴的协方差处（每维两个）。按照如下方法采样得到 $2n + 1$ 个 sigma 点，构成 $n \times (2n + 1)$ 的点集矩阵 $\mathcal{X}$：</p>
<script type="math/tex; mode=display">
\mathcal{X}^{(i)} =
\begin{cases}
    \mu_x &  i = 0 \\
    \mu_x + (\sqrt{(n + \kappa)\Sigma_x})^{(i-1)} & i = 1, ··· , n \\
    \mu_x - (\sqrt{(n + \kappa)\Sigma_x})^{(i-n-1)} & i = n + 1, ··· , 2n
\end{cases}</script><p>其中，$(\sqrt{(n + \kappa)\Sigma_x})^{(i-1)}$ 表示矩阵 $(n + \kappa)\Sigma_x$ 作 <strong>Cholesky 分解</strong>后<strong>下三角矩阵</strong>的第 $i-1$ 列，$(\sqrt{(n + \kappa)\Sigma_x})^{(i-n-1)}$ 同理。</p>
<p><strong>步骤三：sigma 点非线性变换</strong></p>
<p>将每个 sigma 点（即 $\mathcal{X}$ 的每一列）进行 $g(·)$ 的非线性变换，得到变换后的新的点集矩阵 $\mathcal{Y}$：</p>
<script type="math/tex; mode=display">
\mathcal{Y}^{(i)} = g(\mathcal{X}^{(i)}) \quad i = 0, ··· , 2n</script><p><strong>步骤四：加权计算近似均值与近似协方差</strong></p>
<script type="math/tex; mode=display">
\mu_y = \sum_{i=0}^{i=2n}W^{(i)}\mathcal{Y}^{(i)}</script><script type="math/tex; mode=display">
\Sigma_y = \sum_{i=0}^{i=2n}W^{(i)}[\mathcal{Y}^{(i)}-\mu_y][\mathcal{Y}^{(i)}-\mu_y]^T</script><h2 id="1-3-比例无迹变换" class="heading-control"><a href="#1-3-比例无迹变换" class="headerlink" title="1.3 比例无迹变换"></a>1.3 比例无迹变换<a class="heading-anchor" href="#1-3-比例无迹变换" aria-hidden="true"></a></h2><p>从 1.2 节的内容中我们可以发现，当参数 $\kappa &lt; 0$ 时，权重 $W^{(0)} = \frac{\kappa}{n+\kappa} &lt; 0$，加权算得的近似协方差可能存在非半正定的情况。为应对该问题，Julier 等人后来提出无迹变换的改进形式——比例无迹变换，并由 Merwe 等人对其进行了简化。比例无迹变换与一般形式的无迹变换的主要区别体现在参数选取与 sigma 点权重计算上，其主要操作流程如下所述：</p>
<p><strong>步骤一：参数选择与权重计算</strong></p>
<p>比例无迹变换引入了四个外部参数：$\alpha$、$\beta$、$\kappa$ 和 $\lambda$，各 sigma 点（$2n+1$ 个）的权重分配如下：</p>
<script type="math/tex; mode=display">
W_m^{(i)} =
\begin{cases}
    \frac{\lambda}{n+\lambda} & i = 0 \\
    \frac{1}{2(n+\lambda)} & i = 1, ··· , 2n
\end{cases}</script><script type="math/tex; mode=display">
W_c^{(i)} =
\begin{cases}
    \frac{\lambda}{n+\lambda} + 1 -\alpha^2 + \beta  & i = 0 \\
    \frac{1}{2(n+\lambda)} & i = 1, ··· , 2n
\end{cases}</script><p>其中，$W_m^{(i)}$ 表示计算近似均值时 sigma 点的权重，$W_c^{(i)}$ 表示计算近似协方差时 sigma 点的权重。参数 $\lambda$ 满足：</p>
<script type="math/tex; mode=display">
\lambda = \alpha^2(n+\kappa)-n</script><p>参数 $\alpha$ 和 $\kappa$ 为确定 sigma 点分布在均值多远的范围内的比例参数。$\alpha$ 满足 $10^{-4} \le \alpha \le 1$，为避免强非线性系统中的非局部效应问题，$\alpha$ 通常取一个较小值；$\kappa$ 满足 $\kappa \ge 0$，通常取 $\kappa = 3-n$ 或 $\kappa = 0$。</p>
<p>下图呈现了当 $\alpha$ 取值分别为 $0.3$ 和 $1$ 时，sigma 点的分布情况，从图中可以发现，$\alpha$ 取值越大，非均值处的 sigma 点距离均值越远。</p>
<p><img data-src="https://image.shipengx.com/alpha%20%E5%8F%96%E4%B8%8D%E5%90%8C%E5%80%BC%E6%97%B6%20sigma%20%E7%82%B9%E7%9A%84%E6%95%A3%E5%B8%83%E7%A4%BA%E4%BE%8B.png" alt="alpha 取不同值时 sigma 点的散布示例"></p>
<p>参数 $\beta$ 用于引入随机变量概率分布的高阶矩信息，如果分布是精确的高斯分布，则 $\beta = 2$ 是最优选择。</p>
<p><strong>步骤二：确定性采样</strong></p>
<p>通常情况下，siama 点位于均值处及对称分布于主轴的协方差处（每维两个）。按照如下方法采样得到 $2n + 1$ 个 sigma 点，构成 $n \times (2n + 1)$ 的点集矩阵 $\mathcal{X}$：</p>
<script type="math/tex; mode=display">
\mathcal{X}^{(i)} =
\begin{cases}
    \mu_x &  i = 0 \\
    \mu_x + (\sqrt{(n + \lambda)\Sigma_x})^{(i-1)} & i = 1, ··· , n \\
    \mu_x - (\sqrt{(n + \lambda)\Sigma_x})^{(i-n-1)} & i = n + 1, ··· , 2n
\end{cases}</script><p>其中，$(\sqrt{(n + \lambda)\Sigma_x})^{(i-1)}$ 表示矩阵 $(n + \lambda)\Sigma_x$ 作 <strong>Cholesky 分解</strong>后<strong>下三角矩阵</strong>的第 $i-1$ 列，$(\sqrt{(n + \lambda)\Sigma_x})^{(i-n-1)}$ 同理。</p>
<p><strong>步骤三：sigma 点非线性变换</strong></p>
<p>将每个 sigma 点（即 $\mathcal{X}$ 的每一列）进行 $g(·)$ 的非线性变换，得到变换后的新的点集矩阵 $\mathcal{Y}$：</p>
<script type="math/tex; mode=display">
\mathcal{Y}^{(i)} = g(\mathcal{X}^{(i)}) \quad i = 0, ··· , 2n</script><p><strong>步骤四：加权计算近似均值与近似协方差</strong></p>
<script type="math/tex; mode=display">
\mu_y = \sum_{i=0}^{i=2n}W_m^{(i)}\mathcal{Y}^{(i)}</script><script type="math/tex; mode=display">
\Sigma_y = \sum_{i=0}^{i=2n}W_c^{(i)}[\mathcal{Y}^{(i)}-\mu_y][\mathcal{Y}^{(i)}-\mu_y]^T</script><h1 id="2-无迹卡尔曼滤波的假设" class="heading-control"><a href="#2-无迹卡尔曼滤波的假设" class="headerlink" title="2 无迹卡尔曼滤波的假设"></a>2 无迹卡尔曼滤波的假设<a class="heading-anchor" href="#2-无迹卡尔曼滤波的假设" aria-hidden="true"></a></h1><p>无迹卡尔曼滤波与扩展卡尔曼滤波具有相同的前提假设。</p>
<h2 id="2-1-与卡尔曼滤波相同的假设" class="heading-control"><a href="#2-1-与卡尔曼滤波相同的假设" class="headerlink" title="2.1 与卡尔曼滤波相同的假设"></a>2.1 与卡尔曼滤波相同的假设<a class="heading-anchor" href="#2-1-与卡尔曼滤波相同的假设" aria-hidden="true"></a></h2><p><strong>(1) 假设一：状态量服从正态分布</strong></p>
<script type="math/tex; mode=display">
X \sim \mathcal{N}(\mu_X, \ \sigma_X^2)</script><p><strong>(2) 假设二：观测量服从正态分布</strong></p>
<script type="math/tex; mode=display">
Y \sim \mathcal{N}(\mu_Y, \ \sigma_Y^2)</script><p><strong>(3) 假设三：过程噪声服从均值为 0 的正态分布</strong></p>
<script type="math/tex; mode=display">
Q \sim \mathcal{N}(0, \ \sigma_Q^2)</script><p><strong>(4) 假设四：观测噪声服从均值为 0 的正态分布</strong></p>
<script type="math/tex; mode=display">
R \sim \mathcal{N}(0, \ \sigma_R^2)</script><h2 id="2-2-与卡尔曼滤波不同的假设" class="heading-control"><a href="#2-2-与卡尔曼滤波不同的假设" class="headerlink" title="2.2 与卡尔曼滤波不同的假设"></a>2.2 与卡尔曼滤波不同的假设<a class="heading-anchor" href="#2-2-与卡尔曼滤波不同的假设" aria-hidden="true"></a></h2><p><strong>(5) 假设五：状态转移函数和（或）观测函数为非线性函数</strong></p>
<p>在卡尔曼滤波的前提假设中，认为状态方程中的状态转移函数 $f(x)$ 以及观测方程中的观测函数 $h(x)$ 均为线性函数。基于这种线性假设，存在常数或常矩阵 $F$，使得 $f(x)$ 可以写成卡尔曼滤波中的线性形式，存在常数或常矩阵 $H$，使得 $h(x)$ 也可以写成卡尔曼滤波中的线性形式。</p>
<p>不同于标准卡尔曼滤波，无迹卡尔曼滤波处理的是非线性高斯系统，假设系统的状态转移函数和（或）观测函数为非线性函数。</p>
<h1 id="3-无迹卡尔曼滤波算法框架" class="heading-control"><a href="#3-无迹卡尔曼滤波算法框架" class="headerlink" title="3 无迹卡尔曼滤波算法框架"></a>3 无迹卡尔曼滤波算法框架<a class="heading-anchor" href="#3-无迹卡尔曼滤波算法框架" aria-hidden="true"></a></h1><p>根据噪声对系统的状态转移过程和观测过程的影响是线性可加的还是非线性不可加的，无迹卡尔曼滤波算法有两种形式：可加性噪声条件下的无迹卡尔曼滤波算法和非可加性噪声条件下的无迹卡尔曼滤波算法。</p>
<h2 id="3-1-可加性噪声条件下的无迹卡尔曼滤波" class="heading-control"><a href="#3-1-可加性噪声条件下的无迹卡尔曼滤波" class="headerlink" title="3.1 可加性噪声条件下的无迹卡尔曼滤波"></a>3.1 可加性噪声条件下的无迹卡尔曼滤波<a class="heading-anchor" href="#3-1-可加性噪声条件下的无迹卡尔曼滤波" aria-hidden="true"></a></h2><p>在此前的文章<a href="https://blog.shipengx.com/archives/9fb25cec.html">《从概率到贝叶斯滤波》</a>中，我们曾经这样描述系统的状态方程和观测方程：</p>
<script type="math/tex; mode=display">
\begin{cases}
    X_k=f(X_{k-1})+Q_k & \Rightarrow \color{red}{状态方程} \\
    Y_k=h(X_k)+R_k & \Rightarrow \color{red}{观测方程}
\end{cases}</script><p>从上式中我们可以发现，过程噪声 $Q_k$ 和观测噪声 $R_k$ 是以线性可加项的形式存在于系统状态方程和观测方程中的，这种形式的表述基于这样的前提假设：过程噪声 $Q_k$ 对系统状态转移过程的影响是线性的，观测噪声 $R_k$ 对系统观测过程的影响也是线性的。很明显，此种情况下，$Q_k$ 与 $X_k$ 是同维的，$R_k$ 与 $Y_k$ 是同维的。</p>
<p>由此引申出可加性噪声条件下的无迹卡尔曼滤波算法，《概率机器人》第 3.4 节 P53 对算法流程有着很好的描述。假设有如下已知条件：</p>
<ul>
<li>高斯的状态量随机向量 $X$，$n_X$ 维，记 $n_X = n$</li>
<li>$k - 1$ 时刻 $X$ 的后验均值与后验协方差：$\mu_{X_{k-1}}^+$，$\Sigma_{X_{k-1}}^+$</li>
<li>$k$ 时刻的外部控制量输入 $u_k$</li>
<li>高斯的过程噪声随机向量：$Q\sim\mathcal{N}(0, \Sigma_Q)$</li>
<li>状态转移函数：$f(X_{k-1}, u_k)$</li>
<li>高斯的观测量随机向量 $Z$，$n_Z$ 维</li>
<li>$k$ 时刻 $Z$ 的观测取值 $z_k$</li>
<li>高斯的观测噪声随机向量：$R\sim\mathcal{N}(0, \Sigma_R)$</li>
<li>观测函数：$h(X_k)$</li>
</ul>
<p>基于以上已知条件与符号定义，我们总结一下可加性噪声条件下的无迹卡尔曼滤波算法步骤（使用比例无迹变换）。</p>
<p><strong>步骤一：初始化</strong></p>
<p>初始化步骤需要做三件事：</p>
<p><strong>选定滤波初值</strong></p>
<p>根据观测量初值 $z_0$及观测函数 $h(·)$ 计算对应的状态量初始均值 $\mu_{X_0}^+$，设定状态量协方差初值 $\Sigma_{X_0}^+$。</p>
<p><strong>选定无迹变换参数</strong></p>
<p>设定比例无迹变换参数 $\alpha$、$\beta$、$\kappa$ 和 $\lambda$ 的参数值，若使用一般形式的无迹变换，仅需设定 $\kappa$ 的取值。</p>
<p><strong>sigma 点权重计算</strong></p>
<p>根据无迹变换参数取值及权重计算公式计算各 sigma 点权重。</p>
<script type="math/tex; mode=display">
W_m^{(i)} =
\begin{cases}
    \frac{\lambda}{n+\lambda} & i = 0 \\
    \frac{1}{2(n+\lambda)} & i = 1, ··· , 2n
\end{cases}</script><script type="math/tex; mode=display">
W_c^{(i)} =
\begin{cases}
    \frac{\lambda}{n+\lambda} + 1 -\alpha^2 + \beta  & i = 0 \\
    \frac{1}{2(n+\lambda)} & i = 1, ··· , 2n
\end{cases}</script><p>对 $k = 1, 2, 3, ··· ,$ 执行：</p>
<p><strong>步骤二：对 $k-1$ 时刻状态量 $X_{k-1}$ 的后验概率分布进行 sigma 采样</strong></p>
<script type="math/tex; mode=display">
\mathcal{X}_{k-1}^{+(i)} =
\begin{cases}
    \mu_{X_{k-1}}^+ &  i = 0 \\
    \mu_{X_{k-1}}^+ + \gamma(\sqrt{\Sigma_{X_{k-1}}^+})^{(i-1)} & i = 1, ··· , n \\
    \mu_{X_{k-1}}^+ - \gamma(\sqrt{\Sigma_{X_{k-1}}^+})^{(i-n-1)} & i = n + 1, ··· , 2n
\end{cases}</script><p>其中，$\gamma = \sqrt{(n + \lambda)}$。</p>
<p><strong>步骤三：状态转移非线性变换</strong></p>
<script type="math/tex; mode=display">
\mathcal{X}_k^{-*(i)} = f(\mathcal{X}_{k-1}^{+(i)}, u_k), \quad i = 0, 1, 2, ··· , 2n</script><p><strong>步骤四：加权计算 $k$ 时刻状态量 $X_k$ 的先验概率分布</strong></p>
<script type="math/tex; mode=display">
\mu_{X_k}^- = \sum_{i=0}^{i=2n}W_m^{(i)}\mathcal{X}_k^{-*(i)}</script><script type="math/tex; mode=display">
\Sigma_{X_k}^- = \sum_{i=0}^{i=2n}W_c^{(i)}[\mathcal{X}_k^{-*(i)}-\mu_{X_k}^-][\mathcal{X}_k^{-*(i)}-\mu_{X_k}^-]^T+\Sigma_Q</script><p>由于过程噪声是线性可加的，所以此处 $\Sigma_Q$ 直接加在了加权协方差的末尾。</p>
<p><strong>步骤五：对 $k$ 时刻状态量 $X_k$ 的先验概率分布进行 sigma 采样</strong></p>
<script type="math/tex; mode=display">
\mathcal{X}_k^{-(i)} =
\begin{cases}
    \mu_{X_k}^- &  i = 0 \\
    \mu_{X_k}^- + \gamma(\sqrt{\Sigma_{X_k}^-})^{(i-1)} & i = 1, ··· , n \\
    \mu_{X_k}^- - \gamma(\sqrt{\Sigma_{X_k}^-})^{(i-n-1)} & i = n + 1, ··· , 2n
\end{cases}</script><p>某些时候，为降低运算量会省略此步，而在下一步骤中直接使用步骤三中的 sigma 点集 $\mathcal{X}_k^{-*(i)}$，这样做在一定程度上会降低精度。</p>
<p><strong>步骤六：观测非线性变换</strong></p>
<script type="math/tex; mode=display">
\mathcal{Z}_k^{(i)} = h(\mathcal{X}_k^{-(i)}), \quad i = 0, 1, 2, ··· , 2n</script><p><strong>步骤七：加权计算 $k$ 时刻观测量 $Z_k$ 的概率分布</strong></p>
<script type="math/tex; mode=display">
\mu_{Z_k} = \sum_{i=0}^{i=2n}W_m^{(i)}\mathcal{Z}_k^{(i)}</script><script type="math/tex; mode=display">
\Sigma_{Z_k} = \sum_{i=0}^{i=2n}W_c^{(i)}[\mathcal{Z}_k^{(i)}-\mu_{Z_k}][\mathcal{Z}_k^{(i)}-\mu_{Z_k}]^T+\Sigma_R</script><p>由于观测噪声是线性可加的，所以此处 $\Sigma_R$ 直接加在了加权协方差的末尾。</p>
<p><strong>步骤八：计算状态量与观测量的互协方差</strong></p>
<script type="math/tex; mode=display">
\Sigma_{X_kZ_k} = \sum_{i=0}^{i=2n}W_c^{(i)}[\mathcal{X}_k^{-(i)}-\mu_{X_k}^-][\mathcal{Z}_k^{(i)}-\mu_{Z_k}]^T</script><p><strong>步骤九：计算卡尔曼增益</strong></p>
<script type="math/tex; mode=display">
K_k = \Sigma_{X_kZ_k}\Sigma_{Z_k}^{-1}</script><p><strong>步骤十：计算 $k$ 时刻状态量 $X_k$ 的后验概率分布</strong></p>
<script type="math/tex; mode=display">
\mu_{X_k}^+ = \mu_{X_k}^- + K_k(z_k-\mu_{Z_k})</script><script type="math/tex; mode=display">
\Sigma_{X_k}^+ = \Sigma_{X_k}^- - K_k\Sigma_{Z_k}K_k^T</script><p>步骤三、四构成了可加性噪声条件下的无迹卡尔曼滤波算法的预测步，步骤六、七、八、九、十则构成了更新步。可加性噪声条件下的无迹卡尔曼滤波算法流程可总结为：</p>
<p><img data-src="https://image.shipengx.com/%E5%8F%AF%E5%8A%A0%E6%80%A7%E5%99%AA%E5%A3%B0%E6%9D%A1%E4%BB%B6%E4%B8%8B%E7%9A%84%E6%97%A0%E8%BF%B9%E5%8D%A1%E5%B0%94%E6%9B%BC%E6%BB%A4%E6%B3%A2%E7%AE%97%E6%B3%95%E6%B5%81%E7%A8%8B%E5%9B%BE.png" alt="可加性噪声条件下的无迹卡尔曼滤波算法流程图"></p>
<h2 id="3-2-非可加性噪声条件下的无迹卡尔曼滤波" class="heading-control"><a href="#3-2-非可加性噪声条件下的无迹卡尔曼滤波" class="headerlink" title="3.2 非可加性噪声条件下的无迹卡尔曼滤波"></a>3.2 非可加性噪声条件下的无迹卡尔曼滤波<a class="heading-anchor" href="#3-2-非可加性噪声条件下的无迹卡尔曼滤波" aria-hidden="true"></a></h2><p>很多时候，噪声对系统的状态转移和观测的影响并非线性的，此种情况下，$Q_k$ 与 $X_k$ 不一定是同维的，$R_k$ 与 $Y_k$ 也不一定是同维的。此时，系统的状态方程和观测方程演变为：</p>
<script type="math/tex; mode=display">
\begin{cases}
    X_k=f(X_{k-1}, Q_k) & \Rightarrow \color{red}{状态方程} \\
    Y_k=h(X_k, R_k) & \Rightarrow \color{red}{观测方程}
\end{cases}</script><p>过程噪声协方差和观测噪声协方差便不能像 3.1 节中描述的那样直接加在加权协方差的末尾。非可加性噪声条件下的无迹卡尔曼滤波算法的处理方法是<strong>对原始状态量作增广（augment）处理</strong>：</p>
<script type="math/tex; mode=display">
\mu_{X_k}^a =
\begin{bmatrix}
    \mu_{X_k} \\
    \mathbf{0} \\
    \mathbf{0}
\end{bmatrix}, \quad
\Sigma_{X_k}^a =
\begin{bmatrix}
    \Sigma_{X_k} & \mathbf{0} & \mathbf{0} \\
    \mathbf{0} & \Sigma_Q & \mathbf{0}\\
    \mathbf{0} & \mathbf{0} & \Sigma_R
\end{bmatrix}</script><p>注意，上式中的 $\mathbf{0}$ 表示元素均为 $0$ 的块向量或块矩阵，故作了粗体显示，应与常值 $0$ 作区分。增广处理的方式并非只此一种，也可分步增广：在预测步开始前先对上一时刻状态量的后验概率分布作过程噪声增广，再在更新步开始前对当前时刻状态量的先验概率分布作观测噪声增广，《机器人学中的状态估计》一书中使用的便是分步增广的方式，两种增广处理方式实则是等效的。</p>
<p>记过程噪声随机向量 $Q$ 的维度为 $q$，观测噪声随机向量 $R$ 的维度为 $r$，增广状态量 $X_k^a$ 的维度为 $L = n + q + r$。下面我们基于 3.1 节中的已知条件和符号定义，阐述非可加性噪声条件下的无迹卡尔曼滤波算法的流程步骤。</p>
<p><strong>步骤一：初始化</strong></p>
<p>初始化步骤需要做三件事：</p>
<p><strong>选定滤波初值</strong></p>
<p>根据观测量初值 $z_0$及观测函数 $h(·)$ 计算对应的状态量初始均值 $\mu_{X_0}^+$，设定状态量协方差初值 $\Sigma_{X_0}^+$。</p>
<p><strong>选定无迹变换参数</strong></p>
<p>设定比例无迹变换参数 $\alpha$、$\beta$、$\kappa$ 和 $\lambda$ 的参数值，若使用一般形式的无迹变换，仅需设定 $\kappa$ 的取值。</p>
<p><strong>sigma 点权重计算</strong></p>
<p>根据无迹变换参数取值及权重计算公式计算各 sigma 点权重。</p>
<script type="math/tex; mode=display">
W_m^{(i)} =
\begin{cases}
    \frac{\lambda}{L+\lambda} & i = 0 \\
    \frac{1}{2(L+\lambda)} & i = 1, ··· , 2L
\end{cases}</script><script type="math/tex; mode=display">
W_c^{(i)} =
\begin{cases}
    \frac{\lambda}{L+\lambda} + 1 -\alpha^2 + \beta  & i = 0 \\
    \frac{1}{2(L+\lambda)} & i = 1, ··· , 2L
\end{cases}</script><p>对 $k = 1, 2, 3, ··· ,$ 执行：</p>
<p><strong>步骤二：对 $k-1$ 时刻状态量 $X_{k-1}$ 的后验概率分布进行增广处理</strong></p>
<script type="math/tex; mode=display">
\mu_{X_{k-1}}^{+a} =
\begin{bmatrix}
    \mu_{X_{k-1}}^+ \\
    \mathbf{0} \\
    \mathbf{0}
\end{bmatrix}, \quad
\Sigma_{X_{k-1}}^{+a} =
\begin{bmatrix}
    \Sigma_{X_{k-1}}^+ & \mathbf{0} & \mathbf{0} \\
    \mathbf{0} & \Sigma_Q & \mathbf{0}\\
    \mathbf{0} & \mathbf{0} & \Sigma_R
\end{bmatrix}</script><p><strong>步骤三：对 $k-1$ 时刻状态量 $X_{k-1}$ 增广的后验概率分布进行 sigma 采样</strong></p>
<script type="math/tex; mode=display">
\mathcal{X}_{k-1}^{+a(i)} =
\begin{cases}
    \mu_{X_{k-1}}^{+a} &  i = 0 \\
    \mu_{X_{k-1}}^{+a} + \gamma(\sqrt{\Sigma_{X_{k-1}}^{+a}})^{(i-1)} & i = 1, ··· , L \\
    \mu_{X_{k-1}}^{+a} - \gamma(\sqrt{\Sigma_{X_{k-1}}^{+a}})^{(i-L-1)} & i = L + 1, ··· , 2L
\end{cases}</script><p>其中，$\gamma = \sqrt{(L + \lambda)}$，且</p>
<script type="math/tex; mode=display">
\mathcal{X}_{k-1}^{+a(i)} =
\begin{bmatrix}
    \mathcal{X}_{k-1}^{+aX(i)} \\
    \mathcal{X}_{k-1}^{+aQ(i)} \\
    \mathcal{X}_{k-1}^{+aR(i)}
\end{bmatrix},
\quad i = 0, 1, 2, ··· , 2L</script><ul>
<li>$\mathcal{X}_{k-1}^{+a(i)}$ 我们读作 $k-1$ 时刻状态量增广的后验概率分布的 sigma 点集的第 $i$ 列。$\mathcal{X}_{k-1}^{+a}$ 的维度为 $L \times 2L$</li>
<li>$\mathcal{X}_{k-1}^{+aX(i)}$ 我们读作 $k-1$ 时刻状态量增广的后验概率分布的 sigma 点集的状态量分量的第 $i$ 列</li>
<li>$\mathcal{X}_{k-1}^{+aQ(i)}$ 我们读作 $k-1$ 时刻状态量增广的后验概率分布的 sigma 点集的过程噪声分量的第 $i$ 列</li>
<li>$\mathcal{X}_{k-1}^{+aR(i)}$ 我们读作 $k-1$ 时刻状态量增广的后验概率分布的 sigma 点集的观测噪声分量的第 $i$ 列</li>
</ul>
<p><strong>步骤四：状态转移非线性变换</strong></p>
<script type="math/tex; mode=display">
\mathcal{X}_k^{-(i)} = f(\mathcal{X}_{k-1}^{+aX(i)}, u_k, \mathcal{X}_{k-1}^{+aQ(i)}), \quad i = 0, 1, 2, ··· , 2L</script><p>$\mathcal{X}_k^-$ 表示 $k$ 时刻状态量先验概率分布的 sigma 点集，维度为 $n \times 2L$ （这一点需要注意）。再计算 $\mathcal{X}_k^-$ 时，我们只将 $\mathcal{X}_{k-1}^{+aX}$、$u_k$ 和 $\mathcal{X}_{k-1}^{+aQ}$ 传入了状态转移函数 $f(·)$，因为观测噪声对系统的状态转移过程无影响。</p>
<p><strong>步骤五：加权计算 $k$ 时刻状态量 $X_k$ 的先验概率分布</strong></p>
<script type="math/tex; mode=display">
\mu_{X_k}^- = \sum_{i=0}^{i=2L}W_m^{(i)}\mathcal{X}_k^{-(i)}</script><script type="math/tex; mode=display">
\Sigma_{X_k}^- = \sum_{i=0}^{i=2L}W_c^{(i)}[\mathcal{X}_k^{-(i)}-\mu_{X_k}^-][\mathcal{X}_k^{-(i)}-\mu_{X_k}^-]^T</script><p>很明显，步骤四中得到的 $\mathcal{X}_k^-$ 中已包含过程噪声信息，故此处在计算 $\Sigma_{X_k}^-$ 时并未像 3.1 节中那样在等式末尾添加了 $\Sigma_Q$ 项。</p>
<p><strong>步骤六：观测非线性变换</strong></p>
<script type="math/tex; mode=display">
\mathcal{Z}_k^{(i)} = h(\mathcal{X}_k^{-(i)}, \mathcal{X}_{k-1}^{+aR(i)}), \quad i = 0, 1, 2, ··· , 2L</script><p>正如步骤五中所说的，$\mathcal{X}_k^-$ 中已包含过程噪声信息，所以此处我们直接将 $\mathcal{X}_k^-$ 和 $\mathcal{X}_{k-1}^{+aR(i)}$ 传入了观测函数 $h(·)$ 来计算 $k$ 时刻观测量 $Z_k$ 的概率分布对应的 sigma 点集 $\mathcal{Z}_k$，而未像 3.1 节中那样对 $X_k$ 的先验概率分布进行了单独的采样。</p>
<p><strong>步骤七：加权计算 $k$ 时刻观测量 $Z_k$ 的概率分布</strong></p>
<script type="math/tex; mode=display">
\mu_{Z_k} = \sum_{i=0}^{i=2L}W_m^{(i)}\mathcal{Z}_k^{(i)}</script><script type="math/tex; mode=display">
\Sigma_{Z_k} = \sum_{i=0}^{i=2L}W_c^{(i)}[\mathcal{Z}_k^{(i)}-\mu_{Z_k}][\mathcal{Z}_k^{(i)}-\mu_{Z_k}]^T</script><p>很明显，步骤六中得到的 $\mathcal{Z}_k$ 中已包含观测噪声信息，故此处在计算 $\Sigma_{Z_k}$ 时并未像 3.1 节中那样在等式末尾添加了 $\Sigma_R$ 项。</p>
<p><strong>步骤八：计算状态量与观测量的互协方差</strong></p>
<script type="math/tex; mode=display">
\Sigma_{X_kZ_k} = \sum_{i=0}^{i=2L}W_c^{(i)}[\mathcal{X}_k^{-(i)}-\mu_{X_k}^-][\mathcal{Z}_k^{(i)}-\mu_{Z_k}]^T</script><p><strong>步骤九：计算卡尔曼增益</strong></p>
<script type="math/tex; mode=display">
K_k = \Sigma_{X_kZ_k}\Sigma_{Z_k}^{-1}</script><p><strong>步骤十：计算 $k$ 时刻状态量 $X_k$ 的后验概率分布</strong></p>
<script type="math/tex; mode=display">
\mu_{X_k}^+ = \mu_{X_k}^- + K_k(z_k-\mu_{Z_k})</script><script type="math/tex; mode=display">
\Sigma_{X_k}^+ = \Sigma_{X_k}^- - K_k\Sigma_{Z_k}K_k^T</script><p>步骤四、五构成了非可加性噪声条件下的无迹卡尔曼滤波算法的预测步，步骤六、七、八、九、十则构成了更新步。非可加性噪声条件下的无迹卡尔曼滤波算法流程可总结为：</p>
<p><img data-src="https://image.shipengx.com/%E9%9D%9E%E5%8F%AF%E5%8A%A0%E6%80%A7%E5%99%AA%E5%A3%B0%E6%9D%A1%E4%BB%B6%E4%B8%8B%E7%9A%84%E6%97%A0%E8%BF%B9%E5%8D%A1%E5%B0%94%E6%9B%BC%E6%BB%A4%E6%B3%A2%E7%AE%97%E6%B3%95%E6%B5%81%E7%A8%8B%E5%9B%BE.png" alt="非可加性噪声条件下的无迹卡尔曼滤波算法流程图"></p>
<p>在某些系统中，过程噪声和观测噪声可能其中一个对系统的影响是线性的（可加性噪声），而另一个对系统的影响是非线性的（非可加性噪声），这时需要结合 3.1 节与 3.2 节的方法来进行无迹卡尔曼滤波算法的设计，在下面的应用示例中你会看到具体是如何做的。</p>
<h1 id="4-应用实例——基于毫米波雷达与无迹卡尔曼滤波的目标跟踪" class="heading-control"><a href="#4-应用实例——基于毫米波雷达与无迹卡尔曼滤波的目标跟踪" class="headerlink" title="4 应用实例——基于毫米波雷达与无迹卡尔曼滤波的目标跟踪"></a>4 应用实例——基于毫米波雷达与无迹卡尔曼滤波的目标跟踪<a class="heading-anchor" href="#4-应用实例——基于毫米波雷达与无迹卡尔曼滤波的目标跟踪" aria-hidden="true"></a></h1><h2 id="4-1-系统分析" class="heading-control"><a href="#4-1-系统分析" class="headerlink" title="4.1 系统分析"></a>4.1 系统分析<a class="heading-anchor" href="#4-1-系统分析" aria-hidden="true"></a></h2><h3 id="4-1-1-状态转移过程分析" class="heading-control"><a href="#4-1-1-状态转移过程分析" class="headerlink" title="4.1.1 状态转移过程分析"></a>4.1.1 状态转移过程分析<a class="heading-anchor" href="#4-1-1-状态转移过程分析" aria-hidden="true"></a></h3><p>在<a href="https://blog.shipengx.com/archives/ea375326.html">《从贝叶斯滤波到扩展卡尔曼滤波》</a>中，我们讲解了毫米波雷达的检测原理，并基于扩展卡尔曼滤波算法实现了 CV 运动模型下的目标跟踪。此处，我们仍以毫米波雷达传感器为例，来讲解基于无迹卡尔曼滤波算法的目标跟踪过程。</p>
<p>不同的是，此次我们假设被跟踪目标近似地作匀速圆周运动，即运动模型为<strong>恒定转率和速度模型（Constant Turn Rate and Velocity，CTRV）</strong>，如下图所示（图片来自 Udacity）。</p>
<p><img data-src="https://image.shipengx.com/CTRV%20%E8%BF%90%E5%8A%A8%E6%A8%A1%E5%9E%8B%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt="CTRV 运动模型示意图"></p>
<p>在 CTRV 模型中，我们通常对目标在笛卡尔坐标系内的横坐标 $p_x$、纵坐标 $p_y$、线速率 $v$、航向角 $\psi$ 和航向角速率 $\omega$ 进行跟踪，其中 $\omega = \dot{\psi}$。状态量可设为：</p>
<script type="math/tex; mode=display">
X=
\begin{bmatrix}
    p_x \\
    p_y \\
    v \\
    \psi \\
    \omega
\end{bmatrix}</script><p>我们先暂不考虑过程噪声的影响，则系统的状态方程（未计入噪声的）可表示为：</p>
<script type="math/tex; mode=display">
\begin{aligned}
    X_k
    & = X_{k-1} + \int_{t_{k-1}}^{t_k}
        \begin{bmatrix}
            \dot{p_x}(t) \\
            \dot{p_y}(t) \\
            \dot{v}(t) \\
            \dot{\psi}(t) \\
            \dot{\omega}(t)
        \end{bmatrix}\mathrm{d}t \\
    & = X_{k-1} +
        \begin{bmatrix}
            \int_{t_{k-1}}^{t_k}v·\mathrm{cos}(\psi(t))\mathrm{d}t \\
            \int_{t_{k-1}}^{t_k}v·\mathrm{sin}(\psi(t))\mathrm{d}t \\
            0 \\
            \omega \Delta t \\
            0
        \end{bmatrix} \\
    & = X_{k-1} +
        \begin{bmatrix}
            v\int_{t_{k-1}}^{t_k}\mathrm{cos}(\psi_{k-1}+\omega·(t-t_{k-1}))\mathrm{d}t \\
            v\int_{t_{k-1}}^{t_k}\mathrm{sin}(\psi_{k-1}+\omega·(t-t_{k-1}))\mathrm{d}t \\
            0 \\
            \omega \Delta t \\
            0
        \end{bmatrix} \\
\end{aligned}</script><p>由换元法求复合函数定积分，容易得到：</p>
<script type="math/tex; mode=display">
\int_{t_{k-1}}^{t_k}\mathrm{cos}(\psi_{k-1}+\omega·(t-t_{k-1}))\mathrm{d}t = \frac{\mathrm{sin}(\psi_{k-1}+\omega\Delta t)-\mathrm{sin}(\psi_{k-1})}{\omega}, \quad \omega \neq 0</script><script type="math/tex; mode=display">
\int_{t_{k-1}}^{t_k}\mathrm{sin}(\psi_{k-1}+\omega·(t-t_{k-1}))\mathrm{d}t = \frac{-\mathrm{cos}(\psi_{k-1}+\omega\Delta t)+\mathrm{cos}(\psi_{k-1})}{\omega}, \quad \omega \neq 0</script><p>故，求得系统的状态方程（未计入噪声的）为：</p>
<script type="math/tex; mode=display">
X_k = X_{k-1} +
\begin{bmatrix}
    \frac{v}{\omega} \bigl(\mathrm{sin}(\psi_{k-1}+\omega\Delta t)-\mathrm{sin}(\psi_{k-1}) \bigr) \\
    \frac{v}{\omega} \bigl(-\mathrm{cos}(\psi_{k-1}+\omega\Delta t)+\mathrm{cos}(\psi_{k-1}) \bigr) \\
    0 \\
    \omega \Delta t \\
    0
\end{bmatrix}, \quad \omega \neq 0</script><p>CTRV 是 CV 的一般形式，当 $\omega = 0$ 时，CTRV 便退化为 CV：</p>
<script type="math/tex; mode=display">
X_k = X_{k-1} +
\begin{bmatrix}
    v·\mathrm{cos}(\psi_{k-1})\Delta t \\
    v·\mathrm{sin}(\psi_{k-1})\Delta t \\
    0 \\
    0 \\
    0
\end{bmatrix}</script><p>在上面的推导中，我们暂时忽略了过程噪声的干扰，但现实情况是，系统状态转移的过程中，目标的线速率 $v$ 和航向角速率 $\omega$ 并非一成不变，都存在微小扰动。假设 $v$ 受线加速度噪声 $q_a$ 的影响，$\omega$ 受角加速度噪声 $q_{\dot{\omega}}$ 的影响，$q_a$ 和 $q_{\dot{\omega}}$ 均为零均值的高斯白噪声：</p>
<script type="math/tex; mode=display">
q_a \sim \mathcal{N} (0, \sigma_a^2)</script><script type="math/tex; mode=display">
q_{\dot{\omega}} \sim \mathcal{N} (0, \sigma_{\dot{\omega}}^2)</script><p>则系统状态转移过程中总的过程噪声 $Q$ 可表示为：</p>
<script type="math/tex; mode=display">
Q =
\begin{bmatrix}
    q_a \\
    q_{\dot{\omega}}
\end{bmatrix}</script><p>$Q$ 的协方差 $\Sigma_Q$ 为：</p>
<script type="math/tex; mode=display">
\Sigma_Q =
\begin{bmatrix}
    \sigma_a^2 & 0 \\
    0 & \sigma_{\dot{\omega}}^2
\end{bmatrix}</script><p>$q_a$ 和 $q_{\dot{\omega}}$ 都对 $p_x$ 和 $p_y$ 存在影响，但此处我们忽略 $q_{\dot{\omega}}$ 对位移的影响，由运动学公式容易得到系统最终的状态方程：</p>
<script type="math/tex; mode=display">
\begin{aligned}
    X_k
    & = f(X_{k-1}, Q_k) \\
    & = X_{k-1} +
        \begin{bmatrix}
            \frac{v_{k-1} }{\omega_{k-1} } \bigl(\mathrm{sin}(\psi_{k-1}+\omega_{k-1}\Delta t)-\mathrm{sin}(\psi_{k-1}) \bigr) \\
            \frac{v_{k-1} }{\omega_{k-1} } \bigl(-\mathrm{cos}(\psi_{k-1}+\omega_{k-1}\Delta t)+\mathrm{cos}(\psi_{k-1}) \bigr) \\
            0 \\
            \omega_{k-1} \Delta t \\
            0
        \end{bmatrix} +
        \begin{bmatrix}
            \frac{1}{2} (\Delta t)^2 · q_{a, k} · \mathrm{cos}(\psi_{k-1}) \\
            \frac{1}{2} (\Delta t)^2 · q_{a, k} · \mathrm{sin}(\psi_{k-1}) \\
            \Delta t · q_{a, k} \\
            \frac{1}{2} (\Delta t)^2 · q_{\dot{\omega}, k} \\
            \Delta t · q_{\dot{\omega}, k}
        \end{bmatrix}
\end{aligned}</script><h3 id="4-1-2-观测过程分析" class="heading-control"><a href="#4-1-2-观测过程分析" class="headerlink" title="4.1.2 观测过程分析"></a>4.1.2 观测过程分析<a class="heading-anchor" href="#4-1-2-观测过程分析" aria-hidden="true"></a></h3><p>观测量仍然是毫米波雷达极坐标系下目标的径向距离 $\rho$、方向角 $\varphi$ 和径向距离变化率（径向速度）$\dot{\rho}$：</p>
<script type="math/tex; mode=display">
Z=
\begin{bmatrix}
    \rho \\
    \varphi \\
    \dot{\rho}
\end{bmatrix}</script><p>各观测量分量 $\rho$、$\varphi$、$\dot{\varphi}$ 对应的观测噪声分别为 $r_{\rho}$、$r_{\varphi}$、$r_{\dot{\varphi}}$，同样都是零均值的高斯白噪声：</p>
<script type="math/tex; mode=display">
r_{\rho} \sim \mathcal{N} (0, \sigma_{\rho}^2)</script><script type="math/tex; mode=display">
r_{\varphi} \sim \mathcal{N} (0, \sigma_{\varphi}^2)</script><script type="math/tex; mode=display">
r_{\dot{\varphi}} \sim \mathcal{N} (0, \sigma_{\dot{\varphi}}^2)</script><p>则观测过程中总的观测噪声 $R$ 可表示为：</p>
<script type="math/tex; mode=display">
R =
\begin{bmatrix}
    r_{\rho} \\
    r_{\varphi} \\
    r_{\dot{\varphi}}
\end{bmatrix}</script><p>$R$ 的协方差 $\Sigma_R$ 为：</p>
<script type="math/tex; mode=display">
\Sigma_R =
\begin{bmatrix}
    \sigma_{\rho}^2 & 0 & 0 \\
    0 & \sigma_{\varphi}^2 & 0 \\
    0 & 0 & \sigma_{\dot{\varphi}}^2
\end{bmatrix}</script><p>观测方程与<a href="https://blog.shipengx.com/archives/ea375326.html">《从贝叶斯滤波到扩展卡尔曼滤波》</a>中相似，我们直接给出：</p>
<script type="math/tex; mode=display">
\begin{aligned}
    Z_k
    & = h(X_k) + R_k \\
    & = \begin{bmatrix}
            \sqrt{p_{x,k}^2+p_{y,k}^2} \\
            \mathrm{arctan}(\frac{p_{y,k} }{p_{x,k} }) \\
            \frac{v_k·\mathrm{cos}(\psi_k)·p_{x,k}+v_k·\mathrm{sin}(\psi_k)·p_{y,k} }{\sqrt{p_{x,k}^2+p_{y,k}^2} }
        \end{bmatrix} +
        \begin{bmatrix}
            r_{\rho,k} \\
            r_{\varphi,k} \\
            r_{\dot{\varphi},k}
        \end{bmatrix}
\end{aligned}</script><h2 id="4-2-代码实现" class="heading-control"><a href="#4-2-代码实现" class="headerlink" title="4.2 代码实现"></a>4.2 代码实现<a class="heading-anchor" href="#4-2-代码实现" aria-hidden="true"></a></h2><p>从上面的分析中我们可以知道，过程噪声对系统的状态转移过程具有非线性影响，而观测噪声对系统的观测过程具有线性影响，因此需要结合 3.1 节与 3.2 节的内容进行无迹卡尔曼滤波算法的设计：</p>
<ul>
<li>实现 3.2 节的步骤二时，只需将过程噪声 $Q$ 增广到 $X_{k-1}$ 的后验概率分布</li>
</ul>
<script type="math/tex; mode=display">
\mu_{X_{k-1}}^{+a} =
\begin{bmatrix}
    \mu_{X_{k-1}}^+ \\
    \mathbf{0}
\end{bmatrix}, \quad
\Sigma_{X_{k-1}}^{+a} =
\begin{bmatrix}
    \Sigma_{X_{k-1}}^+ & \mathbf{0} \\
    \mathbf{0} & \Sigma_Q
\end{bmatrix}</script><ul>
<li>实现 3.2 节的步骤六时，只需将预测步 sigma 点集 $\mathcal{X}_k^-$ 传入观测函数 $h(·)$</li>
</ul>
<script type="math/tex; mode=display">
\mathcal{Z}_k^{(i)} = h(\mathcal{X}_k^{-(i)}), \quad i = 0, 1, 2, ··· , 2L</script><ul>
<li>实现 3.2 节的步骤七时，直接将观测噪声 $R$ 协方差 $\Sigma_R$ 添加至 $Z_k$ 协方差 $\Sigma_{Z_k}$ 的末尾</li>
</ul>
<script type="math/tex; mode=display">
\Sigma_{Z_k} = \sum_{i=0}^{i=2L}W_c^{(i)}[\mathcal{Z}_k^{(i)}-\mu_{Z_k}][\mathcal{Z}_k^{(i)}-\mu_{Z_k}]^T+\Sigma_R</script><p>下面给出具体的 C++ 代码实现，为简便起见，实现过程中使用的无迹变换为一般形式的无迹变换，UT 参数只有 $\kappa$。代码框架比较清晰，完全遵循了 3.2 节的算法流程图，但没有去跑数据看仿真效果，工程实践中需要调节噪声协方差以及 UT 参数来获得较好的滤波结果。</p>
<p><strong>UnscentedKalmanFilter.h</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> UNSCENTED_KALMAN_FILTER_</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> UNSCENTED_KALMAN_FILTER_</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Eigen/Dense"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UnscentedKalmanFilter</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">bool</span> is_inited;          <span class="comment">// flag of initialization</span></span><br><span class="line">    <span class="keyword">bool</span> just_begin_filt;    <span class="comment">// flag of just begining filt data</span></span><br><span class="line">    <span class="keyword">uint64_t</span> timestamp_last; <span class="comment">// timestamp of last frame: us</span></span><br><span class="line">    <span class="keyword">double</span> dt;               <span class="comment">// delta time: s</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> n_x;     <span class="comment">// dimension of state vector X</span></span><br><span class="line">    <span class="keyword">int</span> n_x_aug; <span class="comment">// dimension of augmented state vector X</span></span><br><span class="line">    <span class="keyword">int</span> n_z;     <span class="comment">// dimension of measurement vector Z</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">double</span> std_a;         <span class="comment">// standard deviation of longitudinal acceleration process noise: m/s^2</span></span><br><span class="line">    <span class="keyword">double</span> std_omega_dot; <span class="comment">// standard deviation of yaw acceleration process noise: rad/s^2</span></span><br><span class="line">    Eigen::MatrixXd Q;    <span class="comment">// process noise covariance matrix</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">double</span> std_rho;     <span class="comment">// standard deviation of range measurement noise: m</span></span><br><span class="line">    <span class="keyword">double</span> std_phi;     <span class="comment">// standard deviation of bearing measurement noise: rad</span></span><br><span class="line">    <span class="keyword">double</span> std_rho_dot; <span class="comment">// standard deviation of range rate measurement noise: m/s</span></span><br><span class="line">    Eigen::MatrixXd R;  <span class="comment">// measurement noise covariance matrix</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">double</span> kappa;            <span class="comment">// unscented transform parameter κ</span></span><br><span class="line">    Eigen::VectorXd weights; <span class="comment">// weights vector of sigma points</span></span><br><span class="line"></span><br><span class="line">    Eigen::VectorXd X;   <span class="comment">// state vector</span></span><br><span class="line">    Eigen::MatrixXd P_x; <span class="comment">// state covariance matrix</span></span><br><span class="line"></span><br><span class="line">    Eigen::VectorXd X_aug;         <span class="comment">// augmented state vector</span></span><br><span class="line">    Eigen::MatrixXd P_x_aug;       <span class="comment">// augmented state covariance matrix</span></span><br><span class="line">    Eigen::MatrixXd Sigmas_x_aug;  <span class="comment">// sigma points of augmented posterior probability distribution of X(k-1)</span></span><br><span class="line">    Eigen::MatrixXd Sigmas_x_pred; <span class="comment">// sigma points of prior probability distribution of X(k)</span></span><br><span class="line"></span><br><span class="line">    Eigen::MatrixXd Sigmas_z_pred; <span class="comment">// sigma points of probability distribution of Z(k)</span></span><br><span class="line"></span><br><span class="line">    Eigen::VectorXd Z;   <span class="comment">// measurement vector</span></span><br><span class="line">    Eigen::MatrixXd P_z; <span class="comment">// measurement covariance matrix</span></span><br><span class="line"></span><br><span class="line">    Eigen::MatrixXd P_xz; <span class="comment">// cross covariance matrix of X and Z</span></span><br><span class="line">    Eigen::MatrixXd K;    <span class="comment">// kalman gain coefficient: K = P_xz * P_z.inverse()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    Eigen::VectorXd Z_meas; <span class="comment">// measurement value vector</span></span><br><span class="line">    <span class="keyword">uint64_t</span> timestamp_now; <span class="comment">// timestamp of current frame: us</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief Construct a new Unscented Kalman Filter object</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    UnscentedKalmanFilter();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief Destroy the Unscented Kalman Filter object</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ~UnscentedKalmanFilter();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief Return the initialization status of the ukf instance.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @return bool</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> &amp;<span class="title">IsInited</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> is_inited; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief Reset the ukf instance.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Reset</span><span class="params">()</span> </span>&#123; is_inited = <span class="literal">false</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief Normalize the input angle to [-PI, PI].</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @param angle</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">NormalizeAngle</span><span class="params">(<span class="keyword">double</span> &amp;angle)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (angle &gt; M_PI)</span><br><span class="line">            angle -= <span class="number">2.0</span> * M_PI;</span><br><span class="line">        <span class="keyword">while</span> (angle &lt; -M_PI)</span><br><span class="line">            angle += <span class="number">2.0</span> * M_PI;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief To update measurement value vector and timestamp.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">RecvRawData</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// Z_meas[0] = rho_new;</span></span><br><span class="line">        <span class="comment">// Z_meas[1] = phi_new;</span></span><br><span class="line">        <span class="comment">// Z_meas[2] = rho_dot_new;</span></span><br><span class="line">        <span class="comment">// timestamp_now = timestamp_new;</span></span><br><span class="line"></span><br><span class="line">        dt = (timestamp_now - timestamp_last) / <span class="number">1E6</span>;</span><br><span class="line">        timestamp_last = timestamp_now;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief Initialization step.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Init</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief Augment posterior probability distribution of X(k-1).</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">AugmentLastPosteriorPDF</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief Sample the augmented posterior probability distribution of X(k-1).</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">SigmaSample</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief Prediction step.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Predict</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief Update step.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure>
<p><strong>UnscentedKalmanFilter.cpp</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"math.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"UnscentedKalmanFilter.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @brief Construct a new Unscented Kalman Filter object</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">UnscentedKalmanFilter::UnscentedKalmanFilter()</span><br><span class="line">    : is_inited(<span class="literal">false</span>),</span><br><span class="line">      just_begin_filt(<span class="literal">false</span>),</span><br><span class="line">      timestamp_last(<span class="number">0</span>),</span><br><span class="line">      dt(<span class="number">0.0</span>),</span><br><span class="line">      n_x(<span class="number">5</span>),</span><br><span class="line">      n_x_aug(<span class="number">7</span>),</span><br><span class="line">      n_z(<span class="number">3</span>),</span><br><span class="line">      std_a(<span class="number">1.5</span>),         <span class="comment">// need to be tuned according to the performance of the ukf</span></span><br><span class="line">      std_omega_dot(<span class="number">0.8</span>), <span class="comment">// need to be tuned according to the performance of the ukf</span></span><br><span class="line">      Q(<span class="number">2</span>, <span class="number">2</span>),</span><br><span class="line">      std_rho(<span class="number">0.3</span>),</span><br><span class="line">      std_phi(<span class="number">0.03</span>),</span><br><span class="line">      std_rho_dot(<span class="number">0.3</span>),</span><br><span class="line">      R(n_z, n_z),</span><br><span class="line">      kappa(<span class="number">0.0</span>),</span><br><span class="line">      weights(<span class="number">2</span> * n_x_aug + <span class="number">1</span>),</span><br><span class="line">      X(n_x),</span><br><span class="line">      P_x(n_x, n_x),</span><br><span class="line">      X_aug(n_x_aug),</span><br><span class="line">      P_x_aug(n_x_aug, n_x_aug),</span><br><span class="line">      Sigmas_x_aug(n_x_aug, <span class="number">2</span> * n_x_aug + <span class="number">1</span>),</span><br><span class="line">      Sigmas_x_pred(n_x, <span class="number">2</span> * n_x_aug + <span class="number">1</span>),</span><br><span class="line">      Sigmas_z_pred(n_z, <span class="number">2</span> * n_x_aug + <span class="number">1</span>),</span><br><span class="line">      Z(n_z),</span><br><span class="line">      P_z(n_z, n_z),</span><br><span class="line">      P_xz(n_x, n_z),</span><br><span class="line">      K(n_x, n_z),</span><br><span class="line">      Z_meas(n_z),</span><br><span class="line">      timestamp_now(<span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @brief Destroy the Unscented Kalman Filter object</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">UnscentedKalmanFilter::~UnscentedKalmanFilter() &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @brief Initialize the unscented kalman filter.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">UnscentedKalmanFilter::Init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!IsInited())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">double</span> rho = Z_meas(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">double</span> phi = Z_meas(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">double</span> rho_dot = Z_meas(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">double</span> px = rho * <span class="built_in">cos</span>(phi);</span><br><span class="line">        <span class="keyword">double</span> py = rho * <span class="built_in">sin</span>(phi);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// the initial value of X(2) confused me: 0, a small value or the initial</span></span><br><span class="line">        <span class="comment">// measurement value of rho_dot?</span></span><br><span class="line">        X &lt;&lt; px, py, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>;</span><br><span class="line"></span><br><span class="line">        P_x &lt;&lt; <span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>,</span><br><span class="line">            <span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>,</span><br><span class="line">            <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>,</span><br><span class="line">            <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>,</span><br><span class="line">            <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>;</span><br><span class="line"></span><br><span class="line">        Q &lt;&lt; std_a * std_a, <span class="number">0.0</span>,</span><br><span class="line">            <span class="number">0.0</span>, std_omega_dot * std_omega_dot;</span><br><span class="line"></span><br><span class="line">        R &lt;&lt; std_rho * std_rho, <span class="number">0.0</span>, <span class="number">0.0</span>,</span><br><span class="line">            <span class="number">0.0</span>, std_phi * std_phi, <span class="number">0.0</span>,</span><br><span class="line">            <span class="number">0.0</span>, <span class="number">0.0</span>, std_rho_dot * std_rho_dot;</span><br><span class="line"></span><br><span class="line">        kappa = <span class="number">3</span> - n_x_aug;</span><br><span class="line"></span><br><span class="line">        weights.fill(<span class="number">1</span> / (<span class="number">2</span> * (n_x_aug + kappa)));</span><br><span class="line">        weights(<span class="number">0</span>) = kappa / (n_x_aug + kappa);</span><br><span class="line"></span><br><span class="line">        is_inited = <span class="literal">true</span>;</span><br><span class="line">        just_begin_filt = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        just_begin_filt = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @brief Augment posterior probability distribution of X(k-1).</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">UnscentedKalmanFilter::AugmentLastPosteriorPDF</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (just_begin_filt)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// augment mean</span></span><br><span class="line">    X_aug.head(<span class="number">5</span>) = X;</span><br><span class="line">    X_aug(<span class="number">5</span>) = <span class="number">0.0</span>;</span><br><span class="line">    X_aug(<span class="number">6</span>) = <span class="number">0.0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// augment covariance</span></span><br><span class="line">    P_x_aug.fill(<span class="number">0.0</span>);</span><br><span class="line">    P_x_aug.topLeftCorner(<span class="number">5</span>, <span class="number">5</span>) = P_x;</span><br><span class="line">    P_x_aug(<span class="number">5</span>, <span class="number">5</span>) = Q(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    P_x_aug(<span class="number">6</span>, <span class="number">6</span>) = Q(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @brief Sample the augmented posterior probability distribution of X(k-1).</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">UnscentedKalmanFilter::SigmaSample</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (just_begin_filt)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">double</span> gamma = <span class="built_in">std</span>::<span class="built_in">sqrt</span>(n_x_aug + kappa);</span><br><span class="line">    Eigen::MatrixXd chol_root = P_x_aug.llt().matrixL();</span><br><span class="line"></span><br><span class="line">    Sigmas_x_aug.col(<span class="number">0</span>) = X_aug;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; <span class="number">2</span> * n_x_aug + <span class="number">1</span>; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (i &lt; n_x_aug + <span class="number">1</span>)</span><br><span class="line">            Sigmas_x_aug.col(i) = X_aug + gamma * chol_root.col(i - <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            Sigmas_x_aug.col(i) = X_aug - gamma * chol_root.col(i - n_x_aug - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @brief Prediction step.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">UnscentedKalmanFilter::Predict</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (just_begin_filt)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// predict sigma points of prior probability distribution of X(k)</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span> * n_x_aug + <span class="number">1</span>; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">double</span> px = Sigmas_x_aug(<span class="number">0</span>, i);</span><br><span class="line">        <span class="keyword">double</span> py = Sigmas_x_aug(<span class="number">1</span>, i);</span><br><span class="line">        <span class="keyword">double</span> v = Sigmas_x_aug(<span class="number">2</span>, i);</span><br><span class="line">        <span class="keyword">double</span> psi = Sigmas_x_aug(<span class="number">3</span>, i);</span><br><span class="line">        <span class="keyword">double</span> omega = Sigmas_x_aug(<span class="number">4</span>, i);</span><br><span class="line">        <span class="keyword">double</span> a = Sigmas_x_aug(<span class="number">5</span>, i);</span><br><span class="line">        <span class="keyword">double</span> omega_dot = Sigmas_x_aug(<span class="number">6</span>, i);</span><br><span class="line"></span><br><span class="line">        <span class="function">Eigen::VectorXd <span class="title">state_trans_item_motion</span><span class="params">(n_x)</span></span>;</span><br><span class="line">        <span class="function">Eigen::VectorXd <span class="title">state_trans_item_noise</span><span class="params">(n_x)</span></span>;</span><br><span class="line"></span><br><span class="line">        state_trans_item_noise &lt;&lt; 0.5 * a * cos(psi) * dt * dt,</span><br><span class="line">            0.5 * a * sin(psi) * dt * dt,</span><br><span class="line">            a * dt,</span><br><span class="line">            <span class="number">0.5</span> * a * omega_dot * dt * dt,</span><br><span class="line">            omega_dot * dt;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">std</span>::<span class="built_in">fabs</span>(omega_dot) &gt; <span class="number">0.001</span>) <span class="comment">// CTRV model</span></span><br><span class="line">        &#123;</span><br><span class="line">            state_trans_item_motion &lt;&lt; v / omega * (<span class="built_in">sin</span>(psi + omega * dt) - <span class="built_in">sin</span>(psi)),</span><br><span class="line">                v / omega * (-<span class="built_in">cos</span>(psi + omega * dt) + <span class="built_in">cos</span>(psi)),</span><br><span class="line">                <span class="number">0.0</span>,</span><br><span class="line">                omega * dt,</span><br><span class="line">                <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="comment">// approximate CV model</span></span><br><span class="line">        &#123;</span><br><span class="line">            state_trans_item_motion &lt;&lt; v * <span class="built_in">cos</span>(psi) * dt,</span><br><span class="line">                v * <span class="built_in">sin</span>(psi) * dt,</span><br><span class="line">                <span class="number">0.0</span>,</span><br><span class="line">                omega * dt,</span><br><span class="line">                <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Sigmas_x_pred.col(i) = Sigmas_x_aug.head(<span class="number">5</span>) + state_trans_item_motion + state_trans_item_noise;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// calculate approximate mean of prior PDF of X(k)</span></span><br><span class="line">    X.fill(<span class="number">0.0</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span> * n_x_aug + <span class="number">1</span>; ++i)</span><br><span class="line">        X += weights(i) * Sigmas_x_pred.col(i);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// calculate approximate covariance of prior PDF of X(k)</span></span><br><span class="line">    P_x.fill(<span class="number">0.0</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span> * n_x_aug + <span class="number">1</span>; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        Eigen::VectorXd x_diff = Sigmas_x_pred.col(i) - X;</span><br><span class="line">        NormalizeAngle(x_diff(<span class="number">3</span>));</span><br><span class="line"></span><br><span class="line">        P_x += weights(i) * x_diff * x_diff.transpose();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @brief Update step.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">UnscentedKalmanFilter::Update</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (just_begin_filt)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// predict sigma points of probability distribution of Z(k)</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span> * n_x_aug + <span class="number">1</span>; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">double</span> px = Sigmas_x_pred(<span class="number">0</span>, i);</span><br><span class="line">        <span class="keyword">double</span> py = Sigmas_x_pred(<span class="number">1</span>, i);</span><br><span class="line">        <span class="keyword">double</span> v = Sigmas_x_pred(<span class="number">2</span>, i);</span><br><span class="line">        <span class="keyword">double</span> psi = Sigmas_x_pred(<span class="number">3</span>, i);</span><br><span class="line"></span><br><span class="line">        Sigmas_z_pred(<span class="number">0</span>, i) = <span class="built_in">std</span>::<span class="built_in">sqrt</span>(px * px + py * py);</span><br><span class="line">        Sigmas_z_pred(<span class="number">1</span>, i) = <span class="built_in">atan2</span>(py, px);</span><br><span class="line">        Sigmas_z_pred(<span class="number">2</span>, i) = (v * <span class="built_in">cos</span>(psi) * px + v * <span class="built_in">sin</span>(psi) * py) / Sigmas_z_pred(<span class="number">0</span>, i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// calculate approximate mean of PDF of Z(k)</span></span><br><span class="line">    Z.fill(<span class="number">0.0</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span> * n_x_aug + <span class="number">1</span>; ++i)</span><br><span class="line">        Z += weights(i) * Sigmas_z_pred.col(i);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// calculate approximate covariance of PDF of Z(k)</span></span><br><span class="line">    P_z.fill(<span class="number">0.0</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span> * n_x_aug + <span class="number">1</span>; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        Eigen::VectorXd z_diff = Sigmas_z_pred.col(i) - Z;</span><br><span class="line">        NormalizeAngle(z_diff(<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">        P_z += weights(i) * z_diff * z_diff.transpose();</span><br><span class="line">    &#125;</span><br><span class="line">    P_z += R;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// calculate cross covariance of X(k) and Z(k)</span></span><br><span class="line">    P_xz.fill(<span class="number">0.0</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span> * n_x_aug + <span class="number">1</span>; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        Eigen::VectorXd x_diff = Sigmas_x_pred.col(i) - X;</span><br><span class="line">        NormalizeAngle(x_diff(<span class="number">3</span>));</span><br><span class="line"></span><br><span class="line">        Eigen::VectorXd z_diff = Sigmas_z_pred.col(i) - Z;</span><br><span class="line">        NormalizeAngle(z_diff(<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">        P_xz += weights(i) * x_diff * z_diff.transpose();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// calculate kalman gain</span></span><br><span class="line">    K = P_xz * P_z.inverse();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// calculate mean of posterior PDF of X(k)</span></span><br><span class="line">    Eigen::VectorXd z_diff = Z_meas - Z;</span><br><span class="line">    NormalizeAngle(z_diff(<span class="number">1</span>));</span><br><span class="line">    X += K * z_diff;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// calculate covariance of posterior PDF of X(k)</span></span><br><span class="line">    P_x -= K * P_z * K.inverse();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>main.cpp</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"UnscentedKalmanFilter.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    UnscentedKalmanFilter ukf;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        ukf.RecvRawData();</span><br><span class="line"></span><br><span class="line">        ukf.Init();</span><br><span class="line">        ukf.AugmentLastPosteriorPDF();</span><br><span class="line">        ukf.SigmaSample();</span><br><span class="line">        ukf.Predict();</span><br><span class="line">        ukf.Update();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>点击<a href="/download/UnscentedKalmanFilter.zip">这里</a>下载完整工程。</p>
<h1 id="5-总结" class="heading-control"><a href="#5-总结" class="headerlink" title="5 总结"></a>5 总结<a class="heading-anchor" href="#5-总结" aria-hidden="true"></a></h1><p>EKF 与 UKF 代表了处理非线性高斯问题的两种思路（UKF 同样适用于非线性非高斯系统）。EKF 利用一阶泰勒级数展开对非线性的状态转移函数 $f(·)$、观测函数 $h(·)$ 进行线性近似；而 UKF 利用确定性采样的方法对随机变量的概率密度函数进行近似。标准 UKF 的计算量与 EKF 相当，但滤波精度要优于 EKF。</p>
<h1 id="参考" class="heading-control"><a href="#参考" class="headerlink" title="参考"></a>参考<a class="heading-anchor" href="#参考" aria-hidden="true"></a></h1><ol>
<li><span class="exturl" data-url="aHR0cHM6Ly9pZWVleHBsb3JlLmllZWUub3JnL2llbDMvMzkyMC8xMTM1Mi8wMDUyOTc4My5wZGY=" title="https://ieeexplore.ieee.org/iel3/3920/11352/00529783.pdf">A New Approach for Filtering Nonlinear Systems<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly93d3cuZ2F0c2J5LnVjbC5hYy51ay9+Ynlyb24vbmxkcy9tZXJ3ZTIwMDNhLnBkZg==" title="https://www.gatsby.ucl.ac.uk/~byron/nlds/merwe2003a.pdf">Sigma-Point Kalman Filters for Probabilistic Inference in Dynamic State-Space Models<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly93d3cuY3MudW5jLmVkdS9+d2VsY2gva2FsbWFuL21lZGlhL3BkZi9KdWxpZXIxOTk3X1NQSUVfS0YucGRm" title="https://www.cs.unc.edu/~welch/kalman/media/pdf/Julier1997_SPIE_KF.pdf">A New Extension of the Kalman Filter to Nonlinear Systems<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly93d3cuY3MudW5jLmVkdS9+d2VsY2gva2FsbWFuL21lZGlhL3BkZi9BQ0MwMi1JRUVFMTM1Ny5QREY=" title="https://www.cs.unc.edu/~welch/kalman/media/pdf/ACC02-IEEE1357.PDF">The Scaled Unscented Transformation<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3JsYWJiZS9LYWxtYW4tYW5kLUJheWVzaWFuLUZpbHRlcnMtaW4tUHl0aG9u" title="https://github.com/rlabbe/Kalman-and-Bayesian-Filters-in-Python">Kalman-and-Bayesian-Filters-in-Python<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9maWx0ZXJweS5yZWFkdGhlZG9jcy5pby9lbi9sYXRlc3Qv" title="https://filterpy.readthedocs.io/en/latest/">FilterPy Documentation<i class="fa fa-external-link"></i></span></li>
<li>《概率机器人》</li>
<li>《机器人学中的状态估计》</li>
<li>《最优状态估计——卡尔曼，$H_∞$ 及非线性滤波》</li>
<li>《卡尔曼滤波与组合导航原理》（第 3 版）</li>
<li><span class="exturl" data-url="aHR0cHM6Ly9tYXguYm9vazExOC5jb20vaHRtbC8yMDE5LzEyMjIvNjEzNTE1NTIxMjAwMjEzMy5zaHRt" title="https://max.book118.com/html/2019/1222/6135155212002133.shtm">EKF 与 UKF<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly93ZW5rdS5iYWlkdS5jb20vdmlldy9kMWVmMmM2YmVmZmRjOGQzNzZlZWFlYWFkMWYzNDY5M2RiZWYxMDc5Lmh0bWwj" title="https://wenku.baidu.com/view/d1ef2c6beffdc8d376eeaeaad1f34693dbef1079.html#">扩展 Kalman 滤波(EKF)和无迹卡尔曼滤波(ukf)分析<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9hZGFtc2hhbi5ibG9nLmNzZG4ubmV0L2FydGljbGUvZGV0YWlscy83ODM1OTA0OA==" title="https://adamshan.blog.csdn.net/article/details/78359048">无人驾驶汽车系统入门（三）——无损卡尔曼滤波，目标追踪，C++<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L09fTU1NTV9PL2FydGljbGUvZGV0YWlscy8xMDYxNDA4NTM=" title="https://blog.csdn.net/O_MMMM_O/article/details/106140853">无迹（损）卡尔曼滤波（UKF）理论讲解与实例<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MDIxNTQ0My9hcnRpY2xlL2RldGFpbHMvODc2OTM2ODA=" title="https://blog.csdn.net/weixin_40215443/article/details/87693680">P6_无损卡尔曼滤波器_udacity 无人驾驶<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dpbGxpYW1oeWluL2FydGljbGUvZGV0YWlscy8xMDYyMDg5MDg=" title="https://blog.csdn.net/williamhyin/article/details/106208908">自动驾驶感知融合-无迹卡尔曼滤波(Lidar&amp;Radar)<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RqZmprajUyL2FydGljbGUvZGV0YWlscy8xMDQ4OTczMTQ=" title="https://blog.csdn.net/djfjkj52/article/details/104897314">CV,CA,CTRV 等运动模型，EKF，UKF 在运动模型下的分析与实践<i class="fa fa-external-link"></i></span></li>
</ol>
<hr>

    </div>

    
    
    
      
  <div class="popular-posts-header">猜你喜欢</div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\archives\9fb25cec.html" rel="bookmark">从概率到贝叶斯滤波</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\archives\3bb74af.html" rel="bookmark">从贝叶斯滤波到卡尔曼滤波</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\archives\ea375326.html" rel="bookmark">从贝叶斯滤波到扩展卡尔曼滤波</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\archives\f3c9e219.html" rel="bookmark">从贝叶斯滤波到粒子滤波</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\archives\e0ebe48c.html" rel="bookmark">最小二乘法多项式曲线拟合数学原理及其C++实现</a></div>
    </li>
  </ul>

        <div class="reward-container">
  <div>Thank you for your donate!</div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechatpay.png" alt="ShiPeng 微信支付">
        <p>微信支付</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/alipay.jpg" alt="ShiPeng 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>ShiPeng
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://blog.shipengx.com/archives/cfd8b171.html" title="从贝叶斯滤波到无迹卡尔曼滤波">https://blog.shipengx.com/archives/cfd8b171.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</span> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/%E8%87%AA%E5%8A%A8%E9%A9%BE%E9%A9%B6/" rel="tag"><i class="fa fa-tag"></i> 自动驾驶</a>
              <a href="/tags/%E6%95%B0%E5%AD%A6/" rel="tag"><i class="fa fa-tag"></i> 数学</a>
              <a href="/tags/%E6%BB%A4%E6%B3%A2/" rel="tag"><i class="fa fa-tag"></i> 滤波</a>
              <a href="/tags/%E6%97%A0%E8%BF%B9%E5%8D%A1%E5%B0%94%E6%9B%BC%E6%BB%A4%E6%B3%A2/" rel="tag"><i class="fa fa-tag"></i> 无迹卡尔曼滤波</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/archives/ea375326.html" rel="prev" title="从贝叶斯滤波到扩展卡尔曼滤波">
      <i class="fa fa-chevron-left"></i> 从贝叶斯滤波到扩展卡尔曼滤波
    </a></div>
      <div class="post-nav-item">
    <a href="/archives/f3c9e219.html" rel="next" title="从贝叶斯滤波到粒子滤波">
      从贝叶斯滤波到粒子滤波 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#目录"><span class="nav-text">目录</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0-引言"><span class="nav-text">0 引言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#1-无迹变换"><span class="nav-text">1 无迹变换</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-什么是无迹变换"><span class="nav-text">1.1 什么是无迹变换</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-一般形式的无迹变换"><span class="nav-text">1.2 一般形式的无迹变换</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3-比例无迹变换"><span class="nav-text">1.3 比例无迹变换</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-无迹卡尔曼滤波的假设"><span class="nav-text">2 无迹卡尔曼滤波的假设</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-与卡尔曼滤波相同的假设"><span class="nav-text">2.1 与卡尔曼滤波相同的假设</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-与卡尔曼滤波不同的假设"><span class="nav-text">2.2 与卡尔曼滤波不同的假设</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-无迹卡尔曼滤波算法框架"><span class="nav-text">3 无迹卡尔曼滤波算法框架</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-可加性噪声条件下的无迹卡尔曼滤波"><span class="nav-text">3.1 可加性噪声条件下的无迹卡尔曼滤波</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-非可加性噪声条件下的无迹卡尔曼滤波"><span class="nav-text">3.2 非可加性噪声条件下的无迹卡尔曼滤波</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-应用实例——基于毫米波雷达与无迹卡尔曼滤波的目标跟踪"><span class="nav-text">4 应用实例——基于毫米波雷达与无迹卡尔曼滤波的目标跟踪</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1-系统分析"><span class="nav-text">4.1 系统分析</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-1-状态转移过程分析"><span class="nav-text">4.1.1 状态转移过程分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-2-观测过程分析"><span class="nav-text">4.1.2 观测过程分析</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-2-代码实现"><span class="nav-text">4.2 代码实现</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5-总结"><span class="nav-text">5 总结</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#参考"><span class="nav-text">参考</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <a href="/">
      <img class="site-author-image" itemprop="image" alt="ShiPeng"
        src="/images/avatar.jpg">
    </a>
  <p class="site-author-name" itemprop="name">ShiPeng</p>
  <div class="site-description" itemprop="description">Stay hungry, stay foolish.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">86</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">26</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">40</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL1JvY1NoaQ==" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;RocShi"><i class="fa fa-fw fa-github"></i></span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS9zaGktcGVuZy04" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;shi-peng-8"><i class="fa fa-fw fa-columns"></i></span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9ib29rLnNoaXBlbmd4LmNvbQ==" title="GitBook → https:&#x2F;&#x2F;book.shipengx.com"><i class="fa fa-fw fa-pencil"></i></span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="bWFpbHRvOlJvY1NoaUBvdXRsb29rLmNvbQ==" title="E-Mail → mailto:RocShi@outlook.com"><i class="fa fa-fw fa-envelope"></i></span>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        
  <div class="beian"><span class="exturl" data-url="aHR0cDovL3d3dy5iZWlhbi5taWl0Lmdvdi5jbg==">冀ICP备20003148号 </span>
  </div>

<div class="copyright">
  
  &copy; 2020 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ShiPeng</span>
</div>

        








      </div>
    </footer>
  </div>

  
  
  <script color='0,0,255' opacity='0.1' zIndex='-1' count='99' src="//cdn.jsdelivr.net/gh/theme-next/theme-next-canvas-nest@1/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  
  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>




  
<script src="/js/local-search.js"></script>













  

  
      
<script type="text/x-mathjax-config">
    MathJax.Ajax.config.path['mhchem'] = '//cdn.jsdelivr.net/npm/mathjax-mhchem@3';

  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$', '$'], ['\\(', '\\)'] ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
        extensions: ['[mhchem]/mhchem.js'],
      equationNumbers: {
        autoNumber: 'AMS'
      }
    }
  });

  MathJax.Hub.Register.StartupHook('TeX Jax Ready', function() {
    MathJax.InputJax.TeX.prefilterHooks.Add(function(data) {
      if (data.display) {
        var next = data.script.nextSibling;
        while (next && next.nodeName.toLowerCase() === '#text') {
          next = next.nextSibling;
        }
        if (next && next.nodeName.toLowerCase() === 'br') {
          next.parentNode.removeChild(next);
        }
      }
    });
  });

  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for (i = 0; i < all.length; i += 1) {
      element = document.getElementById(all[i].inputID + '-Frame').parentNode;
      if (element.nodeName.toLowerCase() == 'li') {
        element = element.parentNode;
      }
      element.classList.add('has-jax');
    }
  });
</script>
<script>
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS-MML_HTMLorMML', () => {
    MathJax.Hub.Typeset();
  }, window.MathJax);
</script>

    

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/valine@1/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el: '#valine-comments',
      verify: false,
      notify: false,
      appId: 'qTmJq982bELvDc6itJCViXS7-gzGzoHsz',
      appKey: '5d8qvijq5fYokwrhKWKYu5F0',
      placeholder: "请写下您的评论，如果您想及时收到回复并被告知，请在上方填写您的昵称与个人邮箱。",
      avatar: 'monsterid',
      meta: guest,
      pageSize: '10' || 10,
      visitor: false,
      lang: 'zh-cn' || 'zh-cn',
      path: location.pathname,
      recordIP: true,
      serverURLs: ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
